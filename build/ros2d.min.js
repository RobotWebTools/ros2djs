var ROS2D=ROS2D||{REVISION:"2-devel"};createjs.Stage.prototype.globalToRos=function(t,e){var i=t/this.scaleX,r=(this.y-e)/this.scaleY;return{x:i,y:r}},createjs.Stage.prototype.rosQuaternionToGlobalTheta=function(t){var e=t.w,i=t.x,r=t.y,o=t.z,n=Math.atan2(2*(e*o+i*r),1-2*(Math.pow(r,2)+Math.pow(o,2))),a=n*(180/Math.PI);return a>=0&&180>=a?a+=270:a-=90,-a},ROS2D.OccupancyGrid=function(t){t=t||{};var e=t.message,i=document.createElement("canvas"),r=i.getContext("2d");this.pose=new ROSLIB.Pose({position:e.info.origin.position,orientation:e.info.origin.orientation}),this.width=e.info.width,this.height=e.info.height,i.width=this.width,i.height=this.height;for(var o=r.createImageData(this.width,this.height),n=0;this.height>n;n++)for(var a=0;this.width>a;a++){var s,c=a+(this.height-n-1)*this.width,h=e.data[c];s=100===h?0:0===h?255:127;var d=4*(a+n*this.width);o.data[d]=s,o.data[++d]=s,o.data[++d]=s,o.data[++d]=255}r.putImageData(o,0,0),createjs.Bitmap.call(this,i),this.y=-this.height*e.info.resolution,this.scaleX=e.info.resolution,this.scaleY=e.info.resolution,this.width*=this.scaleX,this.height*=this.scaleY},ROS2D.OccupancyGrid.prototype.__proto__=createjs.Bitmap.prototype,ROS2D.OccupancyGridClient=function(t){var e=this;t=t||{};var i=t.ros,r=t.topic||"/map";this.continuous=t.continuous,this.rootObject=t.rootObject||new createjs.Container,this.currentGrid=null;var o=new ROSLIB.Topic({ros:i,name:r,messageType:"nav_msgs/OccupancyGrid",compression:"png"});o.subscribe(function(t){e.currentGrid&&e.rootObject.removeChild(e.currentGrid),e.currentGrid=new ROS2D.OccupancyGrid({message:t}),e.rootObject.addChild(e.currentGrid),e.emit("change"),e.continuous||o.unsubscribe()})},ROS2D.OccupancyGridClient.prototype.__proto__=EventEmitter2.prototype,ROS2D.OccupancyGridSrvClient=function(t){var e=this;t=t||{};var i=t.ros,r=t.service||"/static_map";this.rootObject=t.rootObject||new createjs.Container,this.currentGrid=null;var o=new ROSLIB.Service({ros:i,name:r,serviceType:"nav_msgs/GetMap",compression:"png"});o.callService(new ROSLIB.ServiceRequest,function(t){e.currentGrid&&e.rootObject.removeChild(e.currentGrid),e.currentGrid=new ROS2D.OccupancyGrid({message:t.map}),e.rootObject.addChild(e.currentGrid),e.emit("change",e.currentGrid)})},ROS2D.OccupancyGridSrvClient.prototype.__proto__=EventEmitter2.prototype,ROS2D.NavigationArrow=function(t){var e=this;t=t||{};var i=t.size||10,r=t.strokeSize||3,o=t.strokeColor||createjs.Graphics.getRGB(0,0,0),n=t.fillColor||createjs.Graphics.getRGB(255,0,0),a=t.pulse,s=new createjs.Graphics;if(s.setStrokeStyle(r),s.moveTo(-i/2,i/2),s.beginStroke(o),s.beginFill(n),s.lineTo(0,-i),s.lineTo(i/2,i/2),s.lineTo(-i/2,i/2),s.closePath(),s.endFill(),s.endStroke(),createjs.Shape.call(this,s),a){var c=0,h=!0;createjs.Ticker.addEventListener("tick",function(){h?(e.scaleX*=1.035,e.scaleY*=1.035,h=10>++c):(e.scaleX/=1.035,e.scaleY/=1.035,h=0>--c)})}},ROS2D.NavigationArrow.prototype.__proto__=createjs.Shape.prototype,ROS2D.Viewer=function(t){var e=this;t=t||{};var i=t.divID;this.width=t.width,this.height=t.height;var r=t.background||"#111111",o=document.createElement("canvas");o.width=this.width,o.height=this.height,o.style.background=r,document.getElementById(i).appendChild(o),this.scene=new createjs.Stage(o),this.scene.y=this.height,document.getElementById(i).appendChild(o),createjs.Ticker.setFPS(30),createjs.Ticker.addListener(function(){e.scene.update()})},ROS2D.Viewer.prototype.addObject=function(t){this.scene.addChild(t)},ROS2D.Viewer.prototype.scaleToDimensions=function(t,e){this.scene.scaleX=this.width/t,this.scene.scaleY=this.height/e};