var ROS2D=ROS2D||{REVISION:"1"};createjs.Stage.prototype.globalToRos=function(t,e){var i=t/this.scaleX,o=(this.y-e)/this.scaleY;return{x:i,y:o}},createjs.Stage.prototype.rosQuaternionToGlobalTheta=function(t){var e=t.w,i=t.x,o=t.y,s=t.z,a=Math.atan2(2*(e*s+i*o),1-2*(Math.pow(o,2)+Math.pow(s,2))),r=a*(180/Math.PI);return r>=0&&180>=r?r+=270:r-=90,-r},ROS2D.OccupancyGrid=function(t){t=t||{};var e=t.message,i=document.createElement("canvas"),o=i.getContext("2d");this.pose=new ROSLIB.Pose({position:e.info.origin.position,orientation:e.info.origin.orientation}),this.width=e.info.width,this.height=e.info.height,i.width=this.width,i.height=this.height;for(var s=o.createImageData(this.width,this.height),a=0;this.height>a;a++)for(var r=0;this.width>r;r++){var n,h=r+(this.height-a-1)*this.width,c=e.data[h];n=100===c?0:0===c?255:127;var d=4*(r+a*this.width);s.data[d]=n,s.data[++d]=n,s.data[++d]=n,s.data[++d]=255}o.putImageData(s,0,0),createjs.Bitmap.call(this,i),this.y=-this.height*e.info.resolution,this.scaleX=e.info.resolution,this.scaleY=e.info.resolution,this.width*=this.scaleX,this.height*=this.scaleY},ROS2D.OccupancyGrid.prototype.__proto__=createjs.Bitmap.prototype,ROS2D.OccupancyGridClient=function(t){var e=this;t=t||{};var i=t.ros,o=t.topic||"/map";this.continuous=t.continuous,this.rootObject=t.rootObject||new createjs.Container,this.currentGrid=null;var s=new ROSLIB.Topic({ros:i,name:o,messageType:"nav_msgs/OccupancyGrid",compression:"png"});s.subscribe(function(t){e.currentGrid&&e.rootObject.removeChild(e.currentGrid),e.currentGrid=new ROS2D.OccupancyGrid({message:t}),e.rootObject.addChild(e.currentGrid),e.emit("change"),e.continuous||s.unsubscribe()})},ROS2D.OccupancyGridClient.prototype.__proto__=EventEmitter2.prototype,ROS2D.NavigationArrow=function(t){var e=this;t=t||{};var i=t.size||10,o=t.strokeSize||3,s=t.strokeColor||createjs.Graphics.getRGB(0,0,0),a=t.fillColor||createjs.Graphics.getRGB(255,0,0),r=t.pulse,n=new createjs.Graphics;if(n.setStrokeStyle(o),n.moveTo(-i/2,i/2),n.beginStroke(s),n.beginFill(a),n.lineTo(0,-i),n.lineTo(i/2,i/2),n.lineTo(-i/2,i/2),n.closePath(),n.endFill(),n.endStroke(),createjs.Shape.call(this,n),r){var h=0,c=!0;createjs.Ticker.addEventListener("tick",function(){c?(e.scaleX*=1.035,e.scaleY*=1.035,c=10>++h):(e.scaleX/=1.035,e.scaleY/=1.035,c=0>--h)})}},ROS2D.NavigationArrow.prototype.__proto__=createjs.Shape.prototype,ROS2D.Viewer=function(t){var e=this;t=t||{};var i=t.divID;this.width=t.width,this.height=t.height;var o=t.background||"#111111",s=document.createElement("canvas");s.width=this.width,s.height=this.height,s.style.background=o,document.getElementById(i).appendChild(s),this.scene=new createjs.Stage(s),this.scene.y=this.height,document.getElementById(i).appendChild(s),createjs.Ticker.setFPS(30),createjs.Ticker.addListener(function(){e.scene.update()})},ROS2D.Viewer.prototype.addObject=function(t){this.scene.addChild(t)},ROS2D.Viewer.prototype.scaleToDimensions=function(t,e){this.scene.scaleX=this.width/t,this.scene.scaleY=this.height/e};