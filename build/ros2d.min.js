var ROS2D=ROS2D||{REVISION:"1"};createjs.Stage.prototype.globalToRos=function(a,d){var c=a/this.scaleX;var b=(this.y-d)/this.scaleY;return{x:c,y:b}};createjs.Stage.prototype.rosQuaternionToGlobalTheta=function(c){var b=c.w;var a=c.x;var g=c.y;var f=c.z;var d=Math.atan2(2*(b*f+a*g),1-2*(Math.pow(g,2)+Math.pow(f,2)));var e=d*(180/Math.PI);if(e>=0&&e<=180){e+=270}else{e-=90}return -e};ROS2D.OccupancyGrid=function(l){var l=l||{};var k=l.message;var c=document.createElement("canvas");var b=c.getContext("2d");this.pose=new ROSLIB.Pose({position:k.info.origin.position,orientation:k.info.origin.orientation});this.width=k.info.width;this.height=k.info.height;c.width=this.width;c.height=this.height;var a=b.createImageData(this.width,this.height);for(var j=0;j<this.height;j++){for(var e=0;e<this.width;e++){var h=e+((this.height-j-1)*this.width);var g=k.data[h];if(g===100){var d=0}else{if(g===0){var d=255}else{var d=127}}var f=(e+(j*this.width))*4;a.data[f]=d;a.data[++f]=d;a.data[++f]=d;a.data[++f]=255}}b.putImageData(a,0,0);createjs.Bitmap.call(this,c);this.y=-this.height*k.info.resolution;this.scaleX=k.info.resolution;this.scaleY=k.info.resolution;this.width*=this.scaleX;this.height*=this.scaleY};ROS2D.OccupancyGrid.prototype.__proto__=createjs.Bitmap.prototype;ROS2D.OccupancyGridClient=function(d){var e=this;var d=d||{};var b=d.ros;var c=d.topic||"/map";this.continuous=d.continuous;this.rootObject=d.rootObject||new createjs.Container();this.currentGrid=null;var a=new ROSLIB.Topic({ros:b,name:c,messageType:"nav_msgs/OccupancyGrid",compression:"png"});a.subscribe(function(f){if(e.currentGrid){e.rootObject.removeChild(e.currentGrid)}e.currentGrid=new ROS2D.OccupancyGrid({message:f});e.rootObject.addChild(e.currentGrid);e.emit("change");if(!e.continuous){a.unsubscribe()}})};ROS2D.OccupancyGridClient.prototype.__proto__=EventEmitter2.prototype;ROS2D.NavigationArrow=function(b){var b=b||{};var c=b.size||10;var d=b.strokeSize||3;var e=b.strokeColor||createjs.Graphics.getRGB(0,0,0);var f=b.fillColor||createjs.Graphics.getRGB(255,0,0);var a=new createjs.Graphics();a.setStrokeStyle(d);a.moveTo(-c/2,c/2);a.beginStroke(e);a.beginFill(f);a.lineTo(0,-c);a.lineTo(c/2,c/2);a.lineTo(-c/2,c/2);a.closePath();a.endFill();a.endStroke();createjs.Shape.call(this,a)};ROS2D.NavigationArrow.prototype.__proto__=createjs.Shape.prototype;ROS2D.Viewer=function(b){var c=this;var b=b||{};this.divID=b.divID;this.width=b.width;this.height=b.height;this.resolution=b.resolution||0.05;this.background=b.background||"#111111";var a=document.createElement("canvas");a.width=this.width;a.height=this.height;a.style.background=this.background;document.getElementById(this.divID).appendChild(a);this.scene=new createjs.Stage(a);this.scene.y=this.height;document.getElementById(this.divID).appendChild(a);createjs.Ticker.setFPS(30);createjs.Ticker.addListener(function(){c.scene.update()})};ROS2D.Viewer.prototype.addObject=function(a){this.scene.addChild(a)};ROS2D.Viewer.prototype.scaleToDimensions=function(b,a){this.scene.scaleX=this.width/b;this.scene.scaleY=this.height/a};