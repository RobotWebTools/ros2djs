var ROS2D=ROS2D||{REVISION:"2"};createjs.Stage.prototype.globalToRos=function(e,t){var i=(e-this.x)/this.scaleX,s=(this.y-t)/this.scaleY;return{x:i,y:s}},createjs.Stage.prototype.rosQuaternionToGlobalTheta=function(e){var t=e.w,i=e.x,s=e.y,r=e.z,n=Math.atan2(2*(t*r+i*s),1-2*(Math.pow(s,2)+Math.pow(r,2))),o=n*(180/Math.PI);return o>=0&&180>=o?o+=270:o-=90,-o},ROS2D.OccupancyGrid=function(e){e=e||{};var t=e.message,i=document.createElement("canvas"),s=i.getContext("2d");this.pose=new ROSLIB.Pose({position:t.info.origin.position,orientation:t.info.origin.orientation}),this.width=t.info.width,this.height=t.info.height,i.width=this.width,i.height=this.height;for(var r=s.createImageData(this.width,this.height),n=0;this.height>n;n++)for(var o=0;this.width>o;o++){var c,a=o+(this.height-n-1)*this.width,h=t.data[a];c=100===h?0:0===h?255:127;var p=4*(o+n*this.width);r.data[p]=c,r.data[++p]=c,r.data[++p]=c,r.data[++p]=255}s.putImageData(r,0,0),createjs.Bitmap.call(this,i),this.y=-this.height*t.info.resolution,this.scaleX=t.info.resolution,this.scaleY=t.info.resolution,this.width*=this.scaleX,this.height*=this.scaleY,this.x+=this.pose.position.x,this.y-=this.pose.position.y},ROS2D.OccupancyGrid.prototype.__proto__=createjs.Bitmap.prototype,ROS2D.OccupancyGridClient=function(e){var t=this;e=e||{};var i=e.ros,s=e.topic||"/map";this.continuous=e.continuous,this.rootObject=e.rootObject||new createjs.Container,this.currentGrid=null;var r=new ROSLIB.Topic({ros:i,name:s,messageType:"nav_msgs/OccupancyGrid",compression:"png"});r.subscribe(function(e){t.currentGrid&&t.rootObject.removeChild(t.currentGrid),t.currentGrid=new ROS2D.OccupancyGrid({message:e}),t.rootObject.addChild(t.currentGrid),t.emit("change"),t.continuous||r.unsubscribe()})},ROS2D.OccupancyGridClient.prototype.__proto__=EventEmitter2.prototype,ROS2D.OccupancyGridSrvClient=function(e){var t=this;e=e||{};var i=e.ros,s=e.service||"/static_map";this.rootObject=e.rootObject||new createjs.Container,this.currentGrid=null;var r=new ROSLIB.Service({ros:i,name:s,serviceType:"nav_msgs/GetMap",compression:"png"});r.callService(new ROSLIB.ServiceRequest,function(e){t.currentGrid&&t.rootObject.removeChild(t.currentGrid),t.currentGrid=new ROS2D.OccupancyGrid({message:e.map}),t.rootObject.addChild(t.currentGrid),t.emit("change",t.currentGrid)})},ROS2D.OccupancyGridSrvClient.prototype.__proto__=EventEmitter2.prototype,ROS2D.NavigationArrow=function(e){var t=this;e=e||{};var i=e.size||10,s=e.strokeSize||3,r=e.strokeColor||createjs.Graphics.getRGB(0,0,0),n=e.fillColor||createjs.Graphics.getRGB(255,0,0),o=e.pulse,c=new createjs.Graphics;if(c.setStrokeStyle(s),c.moveTo(-i/2,i/2),c.beginStroke(r),c.beginFill(n),c.lineTo(0,-i),c.lineTo(i/2,i/2),c.lineTo(-i/2,i/2),c.closePath(),c.endFill(),c.endStroke(),createjs.Shape.call(this,c),o){var a=0,h=!0;createjs.Ticker.addEventListener("tick",function(){h?(t.scaleX*=1.035,t.scaleY*=1.035,h=10>++a):(t.scaleX/=1.035,t.scaleY/=1.035,h=0>--a)})}},ROS2D.NavigationArrow.prototype.__proto__=createjs.Shape.prototype,ROS2D.Viewer=function(e){var t=this;e=e||{};var i=e.divID;this.width=e.width,this.height=e.height;var s=e.background||"#111111",r=document.createElement("canvas");r.width=this.width,r.height=this.height,r.style.background=s,document.getElementById(i).appendChild(r),this.scene=new createjs.Stage(r),this.scene.y=this.height,document.getElementById(i).appendChild(r),createjs.Ticker.setFPS(30),createjs.Ticker.addListener(function(){t.scene.update()})},ROS2D.Viewer.prototype.addObject=function(e){this.scene.addChild(e)},ROS2D.Viewer.prototype.scaleToDimensions=function(e,t){var i=this.height-this.scene.y*this.scene.scaleY;this.scene.scaleX=this.width/e,this.scene.scaleY=this.height/t,this.scene.x=this.scene.x*this.scene.scaleX,this.scene.y-=i*this.scene.scaleY-i},ROS2D.Viewer.prototype.shift=function(e,t){this.scene.x-=e*this.scene.scaleX,this.scene.y+=t*this.scene.scaleY};